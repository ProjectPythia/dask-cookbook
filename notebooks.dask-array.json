{"version":2,"kind":"Notebook","sha256":"e955dacf9f87e92d49fd92a3aca36394be3622d7d7b4c03f42e57a32cdf74925","slug":"notebooks.dask-array","location":"/notebooks/01-dask-array.ipynb","dependencies":[],"frontmatter":{"title":"Dask Array","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Negin Sobhani","given":"Negin","family":"Sobhani"},"name":"Negin Sobhani","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Vanderwende","given":"Brian","family":"Vanderwende"},"name":"Brian Vanderwende","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Deepak Cherian","given":"Deepak","family":"Cherian"},"name":"Deepak Cherian","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Ben Kirk","given":"Ben","family":"Kirk"},"name":"Ben Kirk","id":"contributors-myst-generated-uid-3"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/dask-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/dask-cookbook/blob/main/notebooks/01-dask-array.ipynb","thumbnail":"/dask-cookbook/build/efb0893141695015b5a57e9702d22b2e.svg","exports":[{"format":"ipynb","filename":"01-dask-array.ipynb","url":"/dask-cookbook/build/01-dask-array-26d2eebdc73487bbb558212e8ee39ffc.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"image","url":"/dask-cookbook/build/efb0893141695015b5a57e9702d22b2e.svg","alt":"Dask logo","width":"30%","key":"unqhC241jx","urlSource":"https://docs.dask.org/en/stable/_images/dask_horizontal.svg"}],"key":"eadWcq6dhA"},{"type":"heading","depth":1,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Dask Array","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bEay0hl2v1"}],"identifier":"dask-array","label":"Dask Array","html_id":"dask-array","implicit":true,"key":"KA5bbzG51B"},{"type":"heading","depth":3,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"In this tutorial, you learn:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Gof1A3h4Ri"}],"identifier":"in-this-tutorial-you-learn","label":"In this tutorial, you learn:","html_id":"in-this-tutorial-you-learn","implicit":true,"key":"ZcnStFw32c"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"What is a Dask Array?","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kRc6xqysIx"}],"key":"lwtEZz7G1X"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Basic concepts and features of Dask Arrays","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"YgvVBUd3Yh"}],"key":"BoziSlPLQv"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Working with Dask arrays","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MKgpw9r2Is"}],"key":"Kyy1mAi0Xy"}],"key":"uDarvOzv2F"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Related Dask Array Documentation","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"bVIE0UtOUM"}],"key":"vFPNE9cQCn"}],"key":"HDxCEmrdES"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"link","url":"https://docs.dask.org/en/stable/array.html","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Dask Array documentation","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"RY6qbrXQ4R"}],"urlSource":"https://docs.dask.org/en/stable/array.html","key":"HBg3S39kAW"}],"key":"ZFr3woyhHE"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"link","url":"https://docs.dask.org/en/stable/array-api.html","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Dask Array API","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"hXROoqDnH5"}],"urlSource":"https://docs.dask.org/en/stable/array-api.html","key":"nHNxfhcZmr"}],"key":"bsIOleXwDv"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"link","url":"https://examples.dask.org/array.html","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Dask Array examples","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"lTVlyMEGzQ"}],"urlSource":"https://examples.dask.org/array.html","key":"tQjb7xlyqc"}],"key":"fKw1drNxme"}],"key":"kClG36kh4W"},{"type":"heading","depth":2,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Dask Arrays","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ySW8sirRb2"}],"identifier":"dask-arrays","label":"Dask Arrays","html_id":"dask-arrays","implicit":true,"key":"dI4cxnY50k"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Dask Arrays are basically parallelized version of NumPy arrays for processing ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"aVorvBsIun"},{"type":"emphasis","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"larger-than-memory data sets","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"xfXgFDwHtx"}],"key":"J4uWZoEbCr"},{"type":"text","value":".","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"lm1yQaSCeS"}],"key":"u70Q8ahwzh"},{"type":"image","style":{"horizontalAlign":"middle"},"url":"/dask-cookbook/build/037e4310c3913e72533173c453c9e52f.svg","width":"500px","key":"iYmSI2Fnzw","urlSource":"https://docs.dask.org/en/stable/_images/dask-array.svg"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Image credit: Dask Contributors","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"whcwiWd5Fy"}],"key":"vtwaAczf19"}],"key":"dvFLiEeYTJ"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Dask Array can be used as a drop-in replacement for NumPy arrays, with a similar API and support for a subset of NumPy functions.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"eLGm2XTzLT"}],"key":"wVXoN73MRT"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Dask effectively reduces the memory footprint of large array computations by dividing the arrays into smaller pieces (called ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"lYRlRPkR5M"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"chunks","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"PSV7PsiQi4"}],"key":"oaUSm5RP7Y"},{"type":"text","value":") that can fit into memory and stream the data from disk.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"p40Bu84K6t"}],"key":"sKTMdEcEsn"}],"visibility":"show","key":"zRhMgNQ6XH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Dask Arrays are lazy:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eaf8XSWBgF"}],"key":"I9jf7y5rbq"},{"type":"text","value":" Unlike Numpy, operations on Dask arrays are not computed until you explicitly request them.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UTvVB9ZnzA"}],"key":"B7Wy2Y1zWn"},{"type":"div","class":"alert alert-success","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Lazy Evaluation: objects are evaluated just in time when the results are needed!","key":"urmwYrMnK1"}],"key":"w7umJJPF9K"}],"key":"hRDe1dcsyT"},{"type":"paragraph","children":[{"type":"text","value":"Lazy evaluation help us avoid having large pieces of memory resident on the workers and optimize the resource requirements.","key":"dOzwLq2Z67"}],"key":"kjDBXhvn6J"}],"key":"ztKQ22hWsQ"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Dask Arrays don’t directly hold any data. Instead, they provide ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TWFAvXlDaj"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"a symbolic representation of the necessary computations","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"BuHkZvxJZ5"}],"key":"OTIRABqfW7"},{"type":"text","value":" to generate the data. We will explain this more below.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Ds4IMeU8c3"}],"key":"EDWcLSs1u8"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Let’s start exploring Dask Arrays:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"OhMDKzckSI"}],"key":"UbKJRX41T8"}],"key":"mNqlMqPEcA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup: Start a Dask Client","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nPOhq7XrA2"}],"identifier":"setup-start-a-dask-client","label":"Setup: Start a Dask Client","html_id":"setup-start-a-dask-client","implicit":true,"key":"LwcTTERMLb"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will talk in-depth about Dask Cluster and Dask Clients later in this tutorial. Here we just created a local cluster and attached a client to it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CpbbgBKOxU"}],"key":"dDDSH7UR3l"}],"key":"vtgpixOG2v"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from dask.distributed import Client\n\nclient = Client()\nclient","visibility":"show","key":"SQVMR4wUEV"},{"type":"output","id":"00N1AX7TG2ghQAAxkhRNs","data":[{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/plain":{"content":"<Client: 'tcp://127.0.0.1:35113' processes=4 threads=4, memory=15.62 GiB>","content_type":"text/plain"},"text/html":{"content":"<div>\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\"> </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px;\">Client</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Client-850e39ff-6a8d-11f0-8f4d-7ced8d570f87</p>\n        <table style=\"width: 100%; text-align: left;\">\n\n        <tr>\n        \n            <td style=\"text-align: left;\"><strong>Connection method:</strong> Cluster object</td>\n            <td style=\"text-align: left;\"><strong>Cluster type:</strong> distributed.LocalCluster</td>\n        \n        </tr>\n\n        \n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\"></td>\n            </tr>\n        \n\n        </table>\n\n        \n            <button style=\"margin-bottom: 12px;\" data-commandlinker-command=\"dask:populate-and-launch-layout\" data-commandlinker-args='{\"url\": \"http://127.0.0.1:8787/status\" }'>\n                Launch dashboard in JupyterLab\n            </button>\n        \n\n        \n            <details>\n            <summary style=\"margin-bottom: 20px;\"><h3 style=\"display: inline;\">Cluster Info</h3></summary>\n            <div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">f1421cae</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 4\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 4\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-4bc97eba-3c2e-4ed2-b51c-ea58e0407d77</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:35113\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:42607\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:45715/status\" target=\"_blank\">http://127.0.0.1:45715/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:34703\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-aoy0f1v2\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:45137\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:44695/status\" target=\"_blank\">http://127.0.0.1:44695/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:45903\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-455kahdq\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:33247\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33633/status\" target=\"_blank\">http://127.0.0.1:33633/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:38563\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-3sgvkmgl\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:43613\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33259/status\" target=\"_blank\">http://127.0.0.1:33259/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:45557\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-bvzr8i84\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>\n            </details>\n        \n\n    </div>\n</div>","content_type":"text/html"}}}],"visibility":"show","key":"LO5pRoqIqW"}],"visibility":"show","key":"cYHm7B3XJF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Blocked Algorithms","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AFPjzb3Mar"}],"identifier":"blocked-algorithms","label":"Blocked Algorithms","html_id":"blocked-algorithms","implicit":true,"key":"fCZ08ClE1T"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Arrays use blocked algorithms to split large computations into smaller computations which operate on subsets of the data (called ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lV1rcb69cE"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"chunks","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kKHFth4Eby"}],"key":"DAcIGSXQNb"},{"type":"text","value":").","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QgLmo5HORG"}],"key":"fmWOwEtjXP"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Let’s see what this means in an example:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aoENXzpFQj"}],"key":"e9vf2gxXVn"}],"key":"LIXuxXrEMh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport dask.array as da\n\n# A 4x4 numpy array that goes from 1 to 16 \n\nnarr = np.array([\n        [ 1,  2,  3,  4],\n        [ 5,  6,  7,  8],\n        [ 9, 10, 11, 12],\n        [13, 14, 15, 16]\n        ])\n\n# -- convert numpy array to dask array with 4 chunks\ndarr = da.from_array( narr,chunks=(2, 2))","key":"oyp5a5Offz"},{"type":"output","id":"6Y6NdjppOHqrr_sfa9RxJ","data":[],"key":"I089njzSdg"}],"key":"HidyfqG77R"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we can calculate the sum of this array using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gh0Yiq0GZK"},{"type":"inlineCode","value":"darr.sum()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Al4pJj33vx"},{"type":"text","value":" similar to numpy. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"r6acVPOHMv"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"But how is it different from numpy?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lVCz6D8Mrt"}],"key":"zU62e3QQYb"}],"key":"WNSVQOKKQ1"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"When you take the sum of the Dask array, Dask first takes the sum of each chunk and only after each of those is completed, takes the sum of the results from each chunk.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bt6Jknnq4X"}],"key":"V3eDMyQORL"},{"type":"image","url":"/dask-cookbook/build/d87210c07d7d63200bb1e0c6b85b4038.jpeg","width":"500px","key":"UvChg6BHDg","urlSource":"https://d33wubrfki0l68.cloudfront.net/f7bf6ca40c8f217386f83795b36e0c964c6a9d2b/ad6da/images/blog/what-is-dask-blockwise-sum.jpg"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Image adapted from ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"In4M8rc4mp"},{"type":"link","url":"http://saturncloud.io","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"saturncloud.io","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"abi8DuOtz7"}],"urlSource":"http://saturncloud.io","key":"D0OvjVViQA"}],"key":"E2ucd8b4Vm"}],"key":"oJaGk9Mu96"}],"key":"gXXTowo5ZK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Task Graph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZQKmS3H3uE"}],"identifier":"task-graph","label":"Task Graph","html_id":"task-graph","implicit":true,"key":"dyj8dhuPeB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Dask Task Graph serves as a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CSuU2wu8Ma"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"blueprint","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mK7uuCOz46"}],"key":"u2aBlut9T4"},{"type":"text","value":" for executing the computations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"omWTMt0net"}],"key":"Trwbr5QiV5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The Task Graph defines the (1) relationships between tasks, and (2) the order in which they should be executed.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BV17uD1iEU"}],"key":"b1YB0QRX0I"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"In a task graph each node in the graph represents a task and lines represent the dependencies/relationships between tasks.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lqyHB7Yvip"}],"key":"edJZIooY3h"}],"key":"jJo24d8bRB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can visualize the low-level task graph using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MiH6K9S9Pt"},{"type":"inlineCode","value":".visualize()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WtvrYeYcs6"},{"type":"text","value":" method.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uy50LQv3Ko"}],"key":"ptSFbukOOQ"}],"key":"dLzooHZZrF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"darr.sum().visualize(rankdir=\"LR\")","key":"ZGBtEcivI1"},{"type":"output","id":"mVbJLAw7A8CzqvwAB1hrZ","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"34fdd51e21f22450d2ee037dd1216709","path":"/dask-cookbook/build/34fdd51e21f22450d2ee037dd1216709.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}}],"key":"m3Xm0F1wHt"}],"key":"eg4rciGoDr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"It is generally good practice to look at the task graph before executing the computation. By looking at the task graph, you can learn about potential bottlenecks where parallelism is not possible.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dhbeX4CxvF"}],"key":"K9DLCcOZjn"},{"type":"div","class":"alert alert-block alert-info","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"TIP:","key":"e8UA0wXm5q"}],"key":"qd7j5HiTtC"},{"type":"text","value":" For big computations, low-level task graphs gets very confusing. An alternative that provides a more concise graph is using ","key":"yHaBxM9lCE"},{"type":"inlineCode","value":".dask.visualize()","key":"reH0Q69cG6"},{"type":"text","value":".","key":"QY7M8oXm1L"}],"key":"dgcSeyGhPE"}],"key":"yJ3Mwo24UN"}],"key":"x16lgsYW1w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#darr.sum().dask.visualize()","key":"TqmDfsFrvy"},{"type":"output","id":"hl1EF5AcR-zB-62ArmYIa","data":[],"key":"ZOtNyAHJ43"}],"key":"M55svRoU2b"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LkNev8lF2C"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Now, let’s start with another example. Here we create a 2D array of ones using NumPy.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WRnw6O7wIw"}],"key":"nUuUAOL88C"}],"key":"jam99lPMe5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"shape = (10000,12000)\n\nones_np = np.ones(shape)\nones_np","key":"atXRwAoHVf"},{"type":"output","id":"EG6PtcfWCSKxiOE2BGT3-","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"array([[1., 1., 1., ..., 1., 1., 1.],\n       [1., 1., 1., ..., 1., 1., 1.],\n       [1., 1., 1., ..., 1., 1., 1.],\n       ...,\n       [1., 1., 1., ..., 1., 1., 1.],\n       [1., 1., 1., ..., 1., 1., 1.],\n       [1., 1., 1., ..., 1., 1., 1.]], shape=(10000, 12000))","content_type":"text/plain"}}}],"key":"vHkuimCSdQ"}],"key":"bl7KkrWaai"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s create the same array using Dask:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c3Uw4Z1hqN"}],"key":"TYgaPWDThU"}],"key":"AnKITjghf2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ones_da = da.ones(shape)\nones_da","key":"Z244v4kTO3"},{"type":"output","id":"5S2s2F8Uhdi60ps_Z6FzL","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"dask.array<ones_like, shape=(10000, 12000), dtype=float64, chunksize=(4096, 4096), chunktype=numpy.ndarray>","content_type":"text/plain"},"text/html":{"content":"<table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 915.53 MiB </td>\n                        <td> 128.00 MiB </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (10000, 12000) </td>\n                        <td> (4096, 4096) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 9 chunks in 1 graph layer </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float64 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"170\" height=\"150\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"120\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"0\" y1=\"40\" x2=\"120\" y2=\"40\" />\n  <line x1=\"0\" y1=\"81\" x2=\"120\" y2=\"81\" />\n  <line x1=\"0\" y1=\"100\" x2=\"120\" y2=\"100\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" style=\"stroke-width:2\" />\n  <line x1=\"40\" y1=\"0\" x2=\"40\" y2=\"100\" />\n  <line x1=\"81\" y1=\"0\" x2=\"81\" y2=\"100\" />\n  <line x1=\"120\" y1=\"0\" x2=\"120\" y2=\"100\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"0.0,0.0 120.0,0.0 120.0,100.0 0.0,100.0\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"60.000000\" y=\"120.000000\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >12000</text>\n  <text x=\"140.000000\" y=\"50.000000\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(-90,140.000000,50.000000)\">10000</text>\n</svg>\n        </td>\n    </tr>\n</table>","content_type":"text/html"}}}],"key":"CUdDaXg4Qd"}],"key":"LeDYbqXOCF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We see a Dask Array representation of the data.\nThis is a symbolic representation; no data has actually been generated yet.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ddJhvGnxLP"}],"key":"nPLDFRIHSy"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"As we discussed previously, this mode of operation is called “lazy”.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"UxwU1VVTmy"}],"key":"D2b8QJF0Gq"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"This allows the user to build up a series of computations or tasks before being passed to the scheduler for execution.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"SJqQzJwLrV"}],"key":"joQfhSh4RB"}],"key":"mpe7VJecWX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uv2e8uN7a8"}],"identifier":"chunks","label":"Chunks","html_id":"chunks","implicit":true,"key":"biKLDq0We5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When checking the Dask array, the symbolic representation illustrates the concept of chunks. Dask arrays split the data into ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yyOxYR9hWu"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"sub-arrays","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xBRxrbNUx7"}],"key":"yHHdjuhwzq"},{"type":"text","value":" (or ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jdmd9rVrA8"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"chunks","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q82WtEp6A1"}],"key":"WnWYYyurP0"},{"type":"text","value":") to optimize computation with large arrays.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jdk9XQai6r"}],"key":"LxJw0Pahim"}],"key":"tAN8jNiOuT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Chunking an array","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L58rYzfJl1"}],"identifier":"chunking-an-array","label":"Chunking an array","html_id":"chunking-an-array","implicit":true,"key":"Eh83sletEJ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The way that arrays are chunked can significantly affect total performance.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QbkehNpkF1"}],"key":"lPQaEPrw0k"}],"key":"pL6E0BJVgY"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For specifying the chunking of an array, we use the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RAhmrsfX73"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"np9JBgvqNA"},{"type":"text","value":" argument when creating our ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rL8bA3T1nh"},{"type":"inlineCode","value":"dask.array","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mLOC6GZMnv"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NTWL1MkllD"}],"key":"a6VDAIOAmB"},{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"⚠️ WARNING:","key":"tdhOF1ZA1M"}],"key":"IgIsSEki91"},{"type":"text","value":" Please note that ","key":"rRLG3p8GT8"},{"type":"inlineCode","value":"chunks","key":"gaOOZtcGdB"},{"type":"text","value":" argument stands for ","key":"eGSac63HfV"},{"type":"strong","children":[{"type":"text","value":"chunk shape","key":"wp26FyvBAv"}],"key":"ANxxEN5pgL"},{"type":"text","value":" rather than “number of chunks”.","key":"VdIkrSNdNq"},{"type":"break","key":"GwpEhnyU0p"},{"type":"text","value":" For example, ","key":"O0LoWuIXE0"},{"type":"inlineCode","value":"chunks=1","key":"ycNG6WTYth"},{"type":"text","value":" means that you will have several chunks with one element.","key":"ByjGeLVSq7"}],"key":"gIZ9p4nvLg"}],"key":"qkWPSSdtze"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"There are several ways to define ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ZQ01PwB8xK"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XyBBuHOIqm"},{"type":"text","value":". For example:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LEf0kzNpWG"}],"key":"tWzXXmXxoT"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"A uniform dimension size like 1000, meaning chunks of size 1000 in each dimension.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"K2CUOlLi78"}],"key":"B1H9IhvvoZ"}],"key":"GrZ84mGIQ6"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"A uniform chunk shape like ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"rGhrOsxMps"},{"type":"inlineCode","value":"(1000, 2000, 3000)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"gdqFFaqaGj"},{"type":"text","value":", meaning chunks of size 1000 in the first axis, 2000 in the second axis, and 3000 in the third.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pH9ApvoPfw"}],"key":"HoVrI7AR43"}],"key":"L47UvsYuFP"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Fully explicit sizes of all blocks for all dimensions, like ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Yh1cnrsLlj"},{"type":"inlineCode","value":"((1000, 1000, 500), (400, 400), (5, 5, 5, 5, 5))","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"baM5RF7kwY"}],"key":"S0S1dZMDfZ"}],"key":"zGrrXubALX"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"A dictionary specifying chunk size per dimension like ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"jhmRaVc7N1"},{"type":"inlineCode","value":"{0: 1000, 1: 2000, 2: 3000}","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"basiDgdwUy"},{"type":"text","value":".","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"aqE6AZKyDi"}],"key":"gfwkGZeatc"}],"key":"WZOqNzDAcA"}],"key":"yLT9axhvN4"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Let’s recreate the above Dask array, but this time we will specify chunk sizes (a.k.a. shapes) using the argument ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"VhaUTpETYx"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"ueuCnyShmp"},{"type":"text","value":".","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"uYbiYAjc2B"}],"key":"CuEjMmCFkb"}],"key":"R76ZaosZWu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# -- remember what the shape of our data array was\nshape","key":"eCVVeWKvJU"},{"type":"output","id":"r5T4Q2LzVjqFnZqcwk3t-","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"(10000, 12000)","content_type":"text/plain"}}}],"key":"Tozbt2FVlV"}],"key":"hJwmpr2YSM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# create a dask array with 6 chunks\nchunk_shape = (5000,4000)\nones_da = da.ones(shape,chunks=chunk_shape)\nones_da","key":"z1NRrXNclD"},{"type":"output","id":"ytDve6DTcL37Cwxr8ecEL","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"dask.array<ones_like, shape=(10000, 12000), dtype=float64, chunksize=(5000, 4000), chunktype=numpy.ndarray>","content_type":"text/plain"},"text/html":{"content":"<table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 915.53 MiB </td>\n                        <td> 152.59 MiB </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (10000, 12000) </td>\n                        <td> (5000, 4000) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 6 chunks in 1 graph layer </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float64 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"170\" height=\"150\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"120\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"0\" y1=\"50\" x2=\"120\" y2=\"50\" />\n  <line x1=\"0\" y1=\"100\" x2=\"120\" y2=\"100\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" style=\"stroke-width:2\" />\n  <line x1=\"40\" y1=\"0\" x2=\"40\" y2=\"100\" />\n  <line x1=\"80\" y1=\"0\" x2=\"80\" y2=\"100\" />\n  <line x1=\"120\" y1=\"0\" x2=\"120\" y2=\"100\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"0.0,0.0 120.0,0.0 120.0,100.0 0.0,100.0\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"60.000000\" y=\"120.000000\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >12000</text>\n  <text x=\"140.000000\" y=\"50.000000\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(-90,140.000000,50.000000)\">10000</text>\n</svg>\n        </td>\n    </tr>\n</table>","content_type":"text/html"}}}],"key":"UYfH1dBRP9"}],"key":"Wc8FOce8Qy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can see in the above dask array representation that we now have 6 chunks, each of shape (5000,4000) and size of ~ 160.0 MiB.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kae3pK1WvP"}],"key":"b8bOeDlIH3"}],"key":"UhNiHcMteQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Performance Comparison","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aAX88tOS6R"}],"identifier":"performance-comparison","label":"Performance Comparison","html_id":"performance-comparison","implicit":true,"key":"Aj8OBSo4n4"}],"key":"HeoSn7RKTV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To compare the performance between a NumPy array and an equivalent Dask array, let’s calculate the mean.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"go8jVysUVM"}],"key":"V7yyc1pzle"}],"key":"C9TleeCIC3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# The %%time cell magic measures the execution time of the whole cell\nones_np.mean()","key":"rC7Hl8QFoD"},{"type":"output","id":"er5sYX02lOFUrbGLRwSG3","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 50.3 ms, sys: 2.85 ms, total: 53.2 ms\nWall time: 50.9 ms\n"},{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"np.float64(1.0)","content_type":"text/plain"}}}],"key":"xzo0haNHyH"}],"key":"nYtrrhvWQD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# Remember, we are not doing any computation here, just constructing our task graph\nmean_of_ones_da = ones_da.mean()","key":"xgbPzY4Kx2"},{"type":"output","id":"dDztG3dTDqNy_Jas2Z7DJ","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 1.7 ms, sys: 0 ns, total: 1.7 ms\nWall time: 1.68 ms\n"}],"key":"m1u5WmF9L5"}],"key":"pJzhaxw56Z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Remember :","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gtfmCnrNYY"}],"key":"OvrGr0SVWm"},{"type":"blockquote","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Dask doesn’t do anything until you tell it... It is lazy!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RwprUS8SxS"}],"key":"sOYZ1sFGHQ"}],"key":"Hn8O0pzHOi"}],"key":"MAD84wCnc7"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"So far we have just constructed our task graph but no computations yet!","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hMiUaBwocf"}],"key":"EoZbzzmZ0J"},{"type":"div","class":"alert alert-success","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"NOTE:","key":"IbMHaZvaL6"}],"key":"G8AH5QPD5f"},{"type":"text","value":" In order to generate the data, we need to call the ","key":"szl7RUp0ET"},{"type":"inlineCode","value":".compute()","key":"FeGGmxYXfG"},{"type":"text","value":" method on the Dask Array to trigger our computation.","key":"vzWy43LqAq"}],"key":"KDO92hWF4k"}],"key":"LCJXXU0RW0"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Let’s run the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"lr3tV6MVpA"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"gEH5ASs4xJ"},{"type":"text","value":" method to see how this works:","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rG1vCIWMoA"}],"key":"sGzJdx9TEd"}],"key":"RE2b765ZkT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nmean_of_ones_da.compute()","key":"lu3JB2LVPI"},{"type":"output","id":"oR3vbF9YpD422r7ILYB9B","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 50.3 ms, sys: 8.87 ms, total: 59.1 ms\nWall time: 1.19 s\n"},{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"np.float64(1.0)","content_type":"text/plain"}}}],"key":"ATxcCYXvUh"}],"key":"mzRILYNFlc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":".compute()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z1uc9iQLvb"},{"type":"text","value":" method convertes Dask Arrays to Numpy Arrays. Let’s check to see if this is true:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YfQiFeKFyw"}],"key":"lXyz5niAIv"}],"key":"l47lvyRCxB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"type (ones_da.compute())","key":"DiGi2WyZyS"},{"type":"output","id":"ZyiAj-acif9EDIR3ZfN9b","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"numpy.ndarray","content_type":"text/plain"}}}],"key":"zt9fXCjKyJ"}],"key":"Mc4vasFfrp"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-warning","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"WARNING:","key":"ynV4vK35nd"}],"key":"zf1ExLr4Fz"},{"type":"text","value":" Typically, when working with Dask arrays, we do not want to generate the data right away by calling ","key":"Kiz27mc870"},{"type":"inlineCode","value":".compute()","key":"vOlIP5bFwZ"},{"type":"text","value":" on a large array.","key":"R2NLoxL2TY"}],"key":"Msbk7bmauO"}],"key":"c5jnQ2rLeB"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"We usually want to perform some computations that reduce the data size. For example, we might compute statistics like the mean or standard deviation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"J0Vgm1ozDj"}],"key":"t3RvC0z4QN"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Let’s look at an example of taking the mean and visualize the task graph. Remember, that no actual computation is taking place until we call ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"sCTtwBcVVk"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zYoLbBGJTK"},{"type":"text","value":".","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Sh8ivr9p2S"}],"key":"cK2hwL7oP6"}],"key":"nt0BKTMWEY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mean_of_ones_da = ones_da.mean()\nmean_of_ones_da.visualize(rankdir=\"LR\")","key":"BZ9qZGqwja"},{"type":"output","id":"Y6r_Ana-o9qVAGgC6qoas","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ff1a7960b95f58c9d001f07f6e8250aa","path":"/dask-cookbook/build/ff1a7960b95f58c9d001f07f6e8250aa.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}}],"key":"ZT2m7bzzzH"}],"key":"sDzcLG2skq"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"liEyGwJEi4"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What are the sizes of these arrays in memory?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VUG8sXcAPp"}],"key":"tvbzOX0Ljo"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"First, let’s define a function that returns array size in MiB.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BOqqT9oekC"}],"key":"Zv9ddSCFTH"}],"key":"HG8XqrCQV8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import sys\n\n# Define function to display variable size in MiB\ndef var_size(in_var):\n    result = sys.getsizeof(in_var) / 1024/1024\n    return (result)","key":"yNlR5k2z9L"},{"type":"output","id":"a83lIw_-tymkY2ciLnx3v","data":[],"key":"oRBkNFhZmB"}],"key":"SkS5gvSQWq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Shape of the numpy array : \", ones_np.shape) \nprint(\"Shape of the dask array  : \", ones_da.shape) \n\n# memory size of numpy array in MiB\nprint(f\"Memory size of numpy array in MB : {var_size(ones_np):.2f} MiB\")\n# memory size of dask array in MiB\nprint(f\"Memory size of dask array in MB  : {var_size(ones_da):.2f} MiB\")","key":"FfgbqVIosH"},{"type":"output","id":"jXXnfoqSP9CLQ_P89sL32","data":[{"output_type":"stream","name":"stdout","text":"Shape of the numpy array :  (10000, 12000)\nShape of the dask array  :  (10000, 12000)\nMemory size of numpy array in MB : 915.53 MiB\nMemory size of dask array in MB  : 0.00 MiB\n"}],"key":"EjkrMu21ut"}],"key":"qqIU98dgiA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Why memory size for the above Dask array is zero?","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZcBE5vRPdZ"}],"key":"aMSsC7q3pn"}],"key":"OMQoOkjfDz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Remember, this variable is only a graph representation of the full array which will be split across workers.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q2F10lUQEo"}],"key":"b8xQ5LjXhm"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"However, Dask does give us ways to see the full size of the data (often much larger than your client machine can handle)!","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v35ADR7UoP"}],"key":"uMuEx0XLfo"}],"key":"UvNDrWk470"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Size of Dask dataset:  {:.2f} MiB\".format(ones_da.nbytes / 1024/1024))","key":"Lscg2IDUZ7"},{"type":"output","id":"RTlTCrLAb9cBF_Igafn1v","data":[{"output_type":"stream","name":"stdout","text":"Size of Dask dataset:  915.53 MiB\n"}],"key":"lNvBjPvRTt"}],"key":"uGadBCBIHw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Larger Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GDUEKas9QX"}],"identifier":"larger-data","label":"Larger Data","html_id":"larger-data","implicit":true,"key":"DwMQMBBm1c"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The previous example illustrated how Dask works, but using Dask is not really necessary (nor advisable) for an array of size 915.53 MiB.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"zc4FtbDlvt"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kjC7yMNvDA"},{"type":"text","value":"Let’s try an example using bigger data and bigger calculations:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Dwy46o5KKZ"}],"key":"tmM3jzdgvK"}],"key":"QzVbyjFg6i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"big_shape = (2000, 200, 2000)\n\n# -- this will make a big numpy array that might not fit on your machine\n#big_np = np.ones(big_shape)","key":"WgFPxc1uZX"},{"type":"output","id":"X-DO8u9EgOP1ybAhBVkJ4","data":[],"key":"FM4xUyULhL"}],"key":"HQAK8FKGo2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Make a similar Dask Array with similar shape but specifying the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TPCuaLxtfy"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k8XbKbD9ur"},{"type":"text","value":" size:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qG9i1GbUQW"}],"key":"o8fx6f2fUC"}],"key":"RQYcqwkvdj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"big_da = da.ones(big_shape)\nbig_da","key":"LlwUpmW41n"},{"type":"output","id":"_pbYxqm5z09sYYknXlZ3H","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"dask.array<ones_like, shape=(2000, 200, 2000), dtype=float64, chunksize=(289, 200, 289), chunktype=numpy.ndarray>","content_type":"text/plain"},"text/html":{"content":"<table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 5.96 GiB </td>\n                        <td> 127.44 MiB </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (2000, 200, 2000) </td>\n                        <td> (289, 200, 289) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 49 chunks in 1 graph layer </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float64 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"250\" height=\"159\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"10\" y1=\"38\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"10\" y2=\"38\" style=\"stroke-width:2\" />\n  <line x1=\"20\" y1=\"10\" x2=\"20\" y2=\"48\" />\n  <line x1=\"30\" y1=\"20\" x2=\"30\" y2=\"58\" />\n  <line x1=\"40\" y1=\"30\" x2=\"40\" y2=\"69\" />\n  <line x1=\"50\" y1=\"40\" x2=\"50\" y2=\"79\" />\n  <line x1=\"61\" y1=\"51\" x2=\"61\" y2=\"89\" />\n  <line x1=\"71\" y1=\"61\" x2=\"71\" y2=\"99\" />\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,109.18509833020366 10.0,38.596863036086\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"130\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"20\" y1=\"10\" x2=\"140\" y2=\"10\" />\n  <line x1=\"30\" y1=\"20\" x2=\"150\" y2=\"20\" />\n  <line x1=\"40\" y1=\"30\" x2=\"160\" y2=\"30\" />\n  <line x1=\"50\" y1=\"40\" x2=\"170\" y2=\"40\" />\n  <line x1=\"61\" y1=\"51\" x2=\"181\" y2=\"51\" />\n  <line x1=\"71\" y1=\"61\" x2=\"191\" y2=\"61\" />\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"27\" y1=\"0\" x2=\"97\" y2=\"70\" />\n  <line x1=\"44\" y1=\"0\" x2=\"115\" y2=\"70\" />\n  <line x1=\"62\" y1=\"0\" x2=\"132\" y2=\"70\" />\n  <line x1=\"79\" y1=\"0\" x2=\"149\" y2=\"70\" />\n  <line x1=\"96\" y1=\"0\" x2=\"167\" y2=\"70\" />\n  <line x1=\"114\" y1=\"0\" x2=\"184\" y2=\"70\" />\n  <line x1=\"130\" y1=\"0\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 130.0,0.0 200.58823529411765,70.58823529411765 80.58823529411765,70.58823529411765\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"80\" y1=\"109\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n  <line x1=\"97\" y1=\"70\" x2=\"97\" y2=\"109\" />\n  <line x1=\"115\" y1=\"70\" x2=\"115\" y2=\"109\" />\n  <line x1=\"132\" y1=\"70\" x2=\"132\" y2=\"109\" />\n  <line x1=\"149\" y1=\"70\" x2=\"149\" y2=\"109\" />\n  <line x1=\"167\" y1=\"70\" x2=\"167\" y2=\"109\" />\n  <line x1=\"184\" y1=\"70\" x2=\"184\" y2=\"109\" />\n  <line x1=\"200\" y1=\"70\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"80.58823529411765,70.58823529411765 200.58823529411765,70.58823529411765 200.58823529411765,109.18509833020366 80.58823529411765,109.18509833020366\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"140.588235\" y=\"129.185098\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >2000</text>\n  <text x=\"220.588235\" y=\"89.886667\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(-90,220.588235,89.886667)\">200</text>\n  <text x=\"35.294118\" y=\"93.890981\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(45,35.294118,93.890981)\">2000</text>\n</svg>\n        </td>\n    </tr>\n</table>","content_type":"text/html"}}}],"key":"Wsl1H5iuI4"}],"key":"GwDLvrttd6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# size of data\n#print(\"Memory size of NumPy dataset :  {:.2f} GiB\".format(big_np.nbytes / 1024/1024/1024))\nprint(\"Memory size of Dask dataset  :  {:.2f} GiB\".format(big_da.nbytes / 1024/1024/1024))","key":"FO32fJlXiN"},{"type":"output","id":"r3qIukyYLLuWSPtO_2XfD","data":[{"output_type":"stream","name":"stdout","text":"Memory size of Dask dataset  :  5.96 GiB\n"}],"key":"ssovWYCtWM"}],"key":"FtMk7IhLPG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This may be close to the available memory/RAM that you have in your computer.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jMu4QVUQHQ"}],"key":"fgXGPR0YwW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s try bigger calculations on this array:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R8IFV5kLr4"}],"key":"AEshmHvfa0"}],"key":"PKa2LylZ4b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#%%time \n#z_np = (big_np + big_np.T)[::2,:].mean()","key":"Leq8mbbmGB"},{"type":"output","id":"QWWfMQzzrl9fyEmvyZWdx","data":[],"key":"esNYR21faJ"}],"key":"Lin3XP3B7O"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\nz_da = (big_da + big_da.T)[::2,:].mean(axis=2)\n\nresult = z_da.compute()","key":"rpbV1A4E4J"},{"type":"output","id":"gskAIiUn0EKN1tr1Ui3k3","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 196 ms, sys: 26 ms, total: 222 ms\nWall time: 1.02 s\n"}],"key":"Jk8nuKwbXE"}],"key":"bc9UFQpoFl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#-- warning : do not try low level visualization with big arrays\n\n#z_da.visualize()","key":"koH811jUBb"},{"type":"output","id":"JAXpSpVNBF9qOC7j1zAQ9","data":[],"key":"VAWfJ1Vt34"}],"key":"N1uhB9hZLM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"All the usual NumPy functions work on dask arrays, though the computations will remain lazy until you either call ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t1oo74pcIZ"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Gc9MgqYgcD"},{"type":"text","value":", ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ygLi1Ln02Z"},{"type":"inlineCode","value":".load()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zI5AlhCeJc"},{"type":"text","value":" or your want to plot the data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EmmVfOGSUk"}],"key":"la1ldXkahx"}],"key":"omTAbKbTV2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As we discussed above, the way that Dask arrays are chunked can significantly affect the performance. In the remainder of this notebook, let’s do a similar calculation using a different ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rTHsksEeAd"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rsMOXiQfdm"},{"type":"text","value":" size.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q8hemfjtOh"}],"key":"pvUwyUFrF9"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will learn more about best practices regarding ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hM9pZhMM1z"},{"type":"inlineCode","value":"chunk","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"S79zjUVSbS"},{"type":"text","value":" size later during the tutorial.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fPHhanczk2"}],"key":"xkHavw3S87"},{"type":"heading","depth":2,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Supplementary Material: Rechunking Arrays","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"oiihw3zJVL"}],"identifier":"supplementary-material-rechunking-arrays","label":"Supplementary Material: Rechunking Arrays","html_id":"supplementary-material-rechunking-arrays","implicit":true,"key":"icu1qYQ2Hj"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We can change the chunking of a Dask array, using the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"YBKAWEHAZX"},{"type":"inlineCode","value":"rechunk","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"eKK9XrYu9A"},{"type":"text","value":" method. Please note that rechunking Dask arrays can be very expensive, so choosing an appropriate chunk size initially is ideal.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Ax8GgMUfml"}],"key":"xsrR0y9KG4"}],"key":"ku6MWeKzB7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"new_chunk_shape = (50,50,50)\nrechunked_big_da = big_da.rechunk(new_chunk_shape)\nrechunked_big_da","key":"ZQUrtKhX44"},{"type":"output","id":"g7RcW75jZbJa5i4pMvkIl","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"dask.array<rechunk-merge, shape=(2000, 200, 2000), dtype=float64, chunksize=(50, 50, 50), chunktype=numpy.ndarray>","content_type":"text/plain"},"text/html":{"content":"<table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 5.96 GiB </td>\n                        <td> 0.95 MiB </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (2000, 200, 2000) </td>\n                        <td> (50, 50, 50) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 6400 chunks in 2 graph layers </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float64 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"250\" height=\"159\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"10\" y1=\"9\" x2=\"80\" y2=\"80\" />\n  <line x1=\"10\" y1=\"19\" x2=\"80\" y2=\"89\" />\n  <line x1=\"10\" y1=\"28\" x2=\"80\" y2=\"99\" />\n  <line x1=\"10\" y1=\"38\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"10\" y2=\"38\" style=\"stroke-width:2\" />\n  <line x1=\"13\" y1=\"3\" x2=\"13\" y2=\"42\" />\n  <line x1=\"17\" y1=\"7\" x2=\"17\" y2=\"45\" />\n  <line x1=\"20\" y1=\"10\" x2=\"20\" y2=\"49\" />\n  <line x1=\"24\" y1=\"14\" x2=\"24\" y2=\"52\" />\n  <line x1=\"27\" y1=\"17\" x2=\"27\" y2=\"56\" />\n  <line x1=\"31\" y1=\"21\" x2=\"31\" y2=\"59\" />\n  <line x1=\"34\" y1=\"24\" x2=\"34\" y2=\"63\" />\n  <line x1=\"38\" y1=\"28\" x2=\"38\" y2=\"66\" />\n  <line x1=\"41\" y1=\"31\" x2=\"41\" y2=\"70\" />\n  <line x1=\"47\" y1=\"37\" x2=\"47\" y2=\"75\" />\n  <line x1=\"50\" y1=\"40\" x2=\"50\" y2=\"79\" />\n  <line x1=\"54\" y1=\"44\" x2=\"54\" y2=\"82\" />\n  <line x1=\"57\" y1=\"47\" x2=\"57\" y2=\"86\" />\n  <line x1=\"61\" y1=\"51\" x2=\"61\" y2=\"89\" />\n  <line x1=\"64\" y1=\"54\" x2=\"64\" y2=\"93\" />\n  <line x1=\"68\" y1=\"58\" x2=\"68\" y2=\"96\" />\n  <line x1=\"71\" y1=\"61\" x2=\"71\" y2=\"100\" />\n  <line x1=\"75\" y1=\"65\" x2=\"75\" y2=\"103\" />\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,109.18509833020366 10.0,38.596863036086\" style=\"fill:#8B4903A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"130\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"13\" y1=\"3\" x2=\"133\" y2=\"3\" />\n  <line x1=\"17\" y1=\"7\" x2=\"137\" y2=\"7\" />\n  <line x1=\"20\" y1=\"10\" x2=\"140\" y2=\"10\" />\n  <line x1=\"24\" y1=\"14\" x2=\"144\" y2=\"14\" />\n  <line x1=\"27\" y1=\"17\" x2=\"147\" y2=\"17\" />\n  <line x1=\"31\" y1=\"21\" x2=\"151\" y2=\"21\" />\n  <line x1=\"34\" y1=\"24\" x2=\"154\" y2=\"24\" />\n  <line x1=\"38\" y1=\"28\" x2=\"158\" y2=\"28\" />\n  <line x1=\"41\" y1=\"31\" x2=\"161\" y2=\"31\" />\n  <line x1=\"47\" y1=\"37\" x2=\"167\" y2=\"37\" />\n  <line x1=\"50\" y1=\"40\" x2=\"170\" y2=\"40\" />\n  <line x1=\"54\" y1=\"44\" x2=\"174\" y2=\"44\" />\n  <line x1=\"57\" y1=\"47\" x2=\"177\" y2=\"47\" />\n  <line x1=\"61\" y1=\"51\" x2=\"181\" y2=\"51\" />\n  <line x1=\"64\" y1=\"54\" x2=\"184\" y2=\"54\" />\n  <line x1=\"68\" y1=\"58\" x2=\"188\" y2=\"58\" />\n  <line x1=\"71\" y1=\"61\" x2=\"191\" y2=\"61\" />\n  <line x1=\"75\" y1=\"65\" x2=\"195\" y2=\"65\" />\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"16\" y1=\"0\" x2=\"86\" y2=\"70\" />\n  <line x1=\"22\" y1=\"0\" x2=\"92\" y2=\"70\" />\n  <line x1=\"28\" y1=\"0\" x2=\"98\" y2=\"70\" />\n  <line x1=\"34\" y1=\"0\" x2=\"104\" y2=\"70\" />\n  <line x1=\"40\" y1=\"0\" x2=\"110\" y2=\"70\" />\n  <line x1=\"46\" y1=\"0\" x2=\"116\" y2=\"70\" />\n  <line x1=\"52\" y1=\"0\" x2=\"122\" y2=\"70\" />\n  <line x1=\"58\" y1=\"0\" x2=\"128\" y2=\"70\" />\n  <line x1=\"64\" y1=\"0\" x2=\"134\" y2=\"70\" />\n  <line x1=\"73\" y1=\"0\" x2=\"143\" y2=\"70\" />\n  <line x1=\"79\" y1=\"0\" x2=\"149\" y2=\"70\" />\n  <line x1=\"85\" y1=\"0\" x2=\"155\" y2=\"70\" />\n  <line x1=\"91\" y1=\"0\" x2=\"161\" y2=\"70\" />\n  <line x1=\"97\" y1=\"0\" x2=\"167\" y2=\"70\" />\n  <line x1=\"103\" y1=\"0\" x2=\"173\" y2=\"70\" />\n  <line x1=\"109\" y1=\"0\" x2=\"179\" y2=\"70\" />\n  <line x1=\"115\" y1=\"0\" x2=\"185\" y2=\"70\" />\n  <line x1=\"121\" y1=\"0\" x2=\"191\" y2=\"70\" />\n  <line x1=\"130\" y1=\"0\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 130.0,0.0 200.58823529411765,70.58823529411765 80.58823529411765,70.58823529411765\" style=\"fill:#8B4903A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"80\" y1=\"80\" x2=\"200\" y2=\"80\" />\n  <line x1=\"80\" y1=\"89\" x2=\"200\" y2=\"89\" />\n  <line x1=\"80\" y1=\"99\" x2=\"200\" y2=\"99\" />\n  <line x1=\"80\" y1=\"109\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n  <line x1=\"86\" y1=\"70\" x2=\"86\" y2=\"109\" />\n  <line x1=\"92\" y1=\"70\" x2=\"92\" y2=\"109\" />\n  <line x1=\"98\" y1=\"70\" x2=\"98\" y2=\"109\" />\n  <line x1=\"104\" y1=\"70\" x2=\"104\" y2=\"109\" />\n  <line x1=\"110\" y1=\"70\" x2=\"110\" y2=\"109\" />\n  <line x1=\"116\" y1=\"70\" x2=\"116\" y2=\"109\" />\n  <line x1=\"122\" y1=\"70\" x2=\"122\" y2=\"109\" />\n  <line x1=\"128\" y1=\"70\" x2=\"128\" y2=\"109\" />\n  <line x1=\"134\" y1=\"70\" x2=\"134\" y2=\"109\" />\n  <line x1=\"143\" y1=\"70\" x2=\"143\" y2=\"109\" />\n  <line x1=\"149\" y1=\"70\" x2=\"149\" y2=\"109\" />\n  <line x1=\"155\" y1=\"70\" x2=\"155\" y2=\"109\" />\n  <line x1=\"161\" y1=\"70\" x2=\"161\" y2=\"109\" />\n  <line x1=\"167\" y1=\"70\" x2=\"167\" y2=\"109\" />\n  <line x1=\"173\" y1=\"70\" x2=\"173\" y2=\"109\" />\n  <line x1=\"179\" y1=\"70\" x2=\"179\" y2=\"109\" />\n  <line x1=\"185\" y1=\"70\" x2=\"185\" y2=\"109\" />\n  <line x1=\"191\" y1=\"70\" x2=\"191\" y2=\"109\" />\n  <line x1=\"200\" y1=\"70\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"80.58823529411765,70.58823529411765 200.58823529411765,70.58823529411765 200.58823529411765,109.18509833020366 80.58823529411765,109.18509833020366\" style=\"fill:#8B4903A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"140.588235\" y=\"129.185098\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >2000</text>\n  <text x=\"220.588235\" y=\"89.886667\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(-90,220.588235,89.886667)\">200</text>\n  <text x=\"35.294118\" y=\"93.890981\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(45,35.294118,93.890981)\">2000</text>\n</svg>\n        </td>\n    </tr>\n</table>","content_type":"text/html"}}}],"key":"rkf0WvOjlJ"}],"key":"zsaChefPWu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# perform big computation on chunked array\n\nz_da_rechunked = (rechunked_big_da + rechunked_big_da.T)[::2,:].mean(axis=2)\n\nresult = z_da_rechunked.compute()","key":"B1Mw6nOpIY"},{"type":"output","id":"6QxSGIBQjA1PJEj674vbP","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 14.8 s, sys: 855 ms, total: 15.6 s\nWall time: 39.2 s\n"}],"key":"WB7k3j0FB7"}],"key":"orXi7MghWm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can see how the choice of smaller chunks (more total chunks) ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wyd4WOuQJi"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"significantly","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j4Ccfg7Tke"}],"key":"yzHmZh6dQj"},{"type":"text","value":" reduce the total performance of our computation.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ReRXua0dXl"}],"key":"JzmWr1V5JH"},{"type":"div","class":"alert alert-block alert-info","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"TIP:","key":"Twb67ZeGB4"}],"key":"vyvxJJNg4g"},{"type":"text","value":" As a rule of thumb, a chunk should be big enough so that the computation on that chunk take significantly longer than the overhead from Dask scheduler. The Dask scheduler takes roughly 1ms per task for scheduling.","key":"CJj0lxRn0V"}],"key":"SAAvxGv3o4"}],"key":"mqzQefTyvy"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Let’s try a bigger chunk size:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Z1xl78B5qT"}],"key":"Xx8AR8rl4m"}],"key":"fwOUeZqX6C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"new_chunk_shape = (500, 100, 500)\n#big_chunk = \n\nrechunked_big_da = big_da.rechunk(new_chunk_shape)\nrechunked_big_da","key":"oo6ypW2g3Y"},{"type":"output","id":"S6YCoF5eEDE04lMba8yEY","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"dask.array<rechunk-merge, shape=(2000, 200, 2000), dtype=float64, chunksize=(500, 100, 500), chunktype=numpy.ndarray>","content_type":"text/plain"},"text/html":{"content":"<table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 5.96 GiB </td>\n                        <td> 190.73 MiB </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (2000, 200, 2000) </td>\n                        <td> (500, 100, 500) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 32 chunks in 2 graph layers </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float64 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"250\" height=\"159\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"10\" y1=\"19\" x2=\"80\" y2=\"89\" />\n  <line x1=\"10\" y1=\"38\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"10\" y2=\"38\" style=\"stroke-width:2\" />\n  <line x1=\"27\" y1=\"17\" x2=\"27\" y2=\"56\" />\n  <line x1=\"45\" y1=\"35\" x2=\"45\" y2=\"73\" />\n  <line x1=\"62\" y1=\"52\" x2=\"62\" y2=\"91\" />\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,109.18509833020366 10.0,38.596863036086\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"130\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"27\" y1=\"17\" x2=\"147\" y2=\"17\" />\n  <line x1=\"45\" y1=\"35\" x2=\"165\" y2=\"35\" />\n  <line x1=\"62\" y1=\"52\" x2=\"182\" y2=\"52\" />\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"10\" y1=\"0\" x2=\"80\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"40\" y1=\"0\" x2=\"110\" y2=\"70\" />\n  <line x1=\"70\" y1=\"0\" x2=\"140\" y2=\"70\" />\n  <line x1=\"100\" y1=\"0\" x2=\"170\" y2=\"70\" />\n  <line x1=\"130\" y1=\"0\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"10.0,0.0 130.0,0.0 200.58823529411765,70.58823529411765 80.58823529411765,70.58823529411765\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Horizontal lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"200\" y2=\"70\" style=\"stroke-width:2\" />\n  <line x1=\"80\" y1=\"89\" x2=\"200\" y2=\"89\" />\n  <line x1=\"80\" y1=\"109\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"80\" y1=\"70\" x2=\"80\" y2=\"109\" style=\"stroke-width:2\" />\n  <line x1=\"110\" y1=\"70\" x2=\"110\" y2=\"109\" />\n  <line x1=\"140\" y1=\"70\" x2=\"140\" y2=\"109\" />\n  <line x1=\"170\" y1=\"70\" x2=\"170\" y2=\"109\" />\n  <line x1=\"200\" y1=\"70\" x2=\"200\" y2=\"109\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"80.58823529411765,70.58823529411765 200.58823529411765,70.58823529411765 200.58823529411765,109.18509833020366 80.58823529411765,109.18509833020366\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"140.588235\" y=\"129.185098\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >2000</text>\n  <text x=\"220.588235\" y=\"89.886667\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(-90,220.588235,89.886667)\">200</text>\n  <text x=\"35.294118\" y=\"93.890981\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(45,35.294118,93.890981)\">2000</text>\n</svg>\n        </td>\n    </tr>\n</table>","content_type":"text/html"}}}],"key":"jJnffsr70Z"}],"key":"KO840oVtRK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# perform big computation on chunked array\n\nz_da_rechunked = (rechunked_big_da + rechunked_big_da.T)[::2,:].mean(axis=2)\n\nresult = z_da_rechunked.compute()","key":"WxMamAJT5t"},{"type":"output","id":"WWuxFiGFcTBaM58pG8aVu","data":[{"output_type":"stream","name":"stdout","text":"CPU times: user 818 ms, sys: 80.5 ms, total: 898 ms\nWall time: 7.37 s\n"}],"key":"R5RvGdPz0a"}],"key":"ayrR7osmzC"},{"type":"block","kind":"notebook-content","children":[{"type":"div","class":"alert alert-block alert-info","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"TIP:","key":"mK7CXzwRXN"}],"key":"bD0Z7LDY8u"},{"type":"text","value":" As a rule of thumb, a chunk should be small enough to fit comfortably in the memory. Chunk sizes between 10MB-1GB are common, depending on your machine,","key":"XUeccdR1HW"}],"key":"PwfFIO4dDH"}],"key":"oIeuWtXKgM"}],"key":"XYBD8BKVDg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"client.close()","key":"G1aN7aVS3a"},{"type":"output","id":"Zl0TCP44TMk0oY0QwE0-I","data":[],"key":"ZOg8cKKM9J"}],"key":"hvELmdgW5t"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eQVRoTdII6"}],"identifier":"summary","label":"Summary:","html_id":"summary","implicit":true,"key":"EsBw42YPmF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dask Array provides parallel computing capabilities by dividing arrays into smaller pieces called chunks.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"p8UxBNTu7m"}],"key":"duzZwhLFer"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Blocked algorithms split large computations into smaller computations which operate on subsets of the array.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OD3kIn32Vw"}],"key":"gLDhT5xpsL"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Dask Array supports efficient computation on large arrays through a combination of lazy evaluation and task parallelism.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kAHpTBN5AU"}],"key":"xhWJioZdoa"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Dask Array can be used as a drop-in replacement for NumPy ndarray, with a similar API and support for a subset of NumPy functions.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"U1YOV3zdSL"}],"key":"s5Ls7F0Jgz"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The way that arrays are chunked can significantly affect total performance. Poor chunking can singifincantly worsen performance of Dask compared to NumPy.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"p8N2VxG6WK"}],"key":"HJzaMJozAB"}],"key":"pQ1EUEyzYz"}],"key":"nwsqprAPyC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Resources and references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qDYxUt6LzT"}],"identifier":"resources-and-references","label":"Resources and references","html_id":"resources-and-references","implicit":true,"key":"LUXE5Nq54K"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Reference","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UInhNXgvPz"}],"key":"VSOmpMdlZl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"link","url":"https://dask.org/","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Dask Docs","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"iL9biDGS7n"}],"urlSource":"https://dask.org/","key":"QI19YGPJmA"}],"key":"u0asrIQC8E"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://examples.dask.org/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Dask Examples","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"c04vkECLnF"}],"urlSource":"https://examples.dask.org/","key":"lRHRsBVfV1"}],"key":"xsGTMFBXMZ"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://github.com/dask/dask/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Dask Code","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mtI3gEaPo7"}],"urlSource":"https://github.com/dask/dask/","error":true,"key":"qpy7t44PjT"}],"key":"eOTaqnB4ik"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"link","url":"https://blog.dask.org/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Dask Blog","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GINFiaAOSl"}],"urlSource":"https://blog.dask.org/","key":"bnOt83TtH7"}],"key":"og2SSJgjZO"}],"key":"Vd4rtEkmNf"}],"key":"GCnSTXNhwN"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Ask for help","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"cru1kYQf2x"}],"key":"OzJMvje8qZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"http://stackoverflow.com/questions/tagged/dask","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"dask","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"gX9Y6zCi9s"}],"urlSource":"http://stackoverflow.com/questions/tagged/dask","key":"nNGKTV6Qg2"},{"type":"text","value":" tag on Stack Overflow, for usage questions","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ZMFF0cAP5Q"}],"key":"MS5z2DbaDs"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"link","url":"https://github.com/dask/dask/discussions","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"github discussions: dask","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"O8LW5eBurW"}],"urlSource":"https://github.com/dask/dask/discussions","error":true,"key":"ysdyNuCleN"},{"type":"text","value":" for general, non-bug, discussion, and usage questions","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"JC9uVsrqRS"}],"key":"dp66NdiLel"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"link","url":"https://github.com/dask/dask/issues/new","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"github issues: dask","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"UTV2yf60pp"}],"urlSource":"https://github.com/dask/dask/issues/new","error":true,"key":"O0Tg5uOdD9"},{"type":"text","value":" for bug reports and feature requests","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"iJfH6Mw0rf"}],"key":"q6nNvMUWpr"}],"key":"MdV1ktVUbh"}],"key":"B7A8kldibn"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Pieces of this notebook are adapted from the following sources","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"YwW2gSLijc"}],"key":"gFSMu3iCgs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"link","url":"https://tutorial.dask.org/02_array.html#Performance-comparison","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Dask Performace Comparison","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"ZXJjrh8hHL"}],"urlSource":"https://tutorial.dask.org/02_array.html#Performance-comparison","key":"BQYlldhZLd"}],"key":"tbzFK4Gc0I"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"link","url":"https://earth-env-data-science.github.io/lectures/dask/dask_arrays.html","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Dask Arrays by EEDS","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"r8bK965xOm"}],"urlSource":"https://earth-env-data-science.github.io/lectures/dask/dask_arrays.html","key":"VkUqscLaL7"}],"key":"g9JGR57tAv"}],"key":"zEuIoE38RO"}],"key":"m5fVGkOp5B"}],"key":"OfkdH7a8EC"}],"key":"xtsUDq5eO0"}],"key":"X1Pwbv2nD3"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Dask Overview","url":"/notebooks/dask-overview","group":"Introductions to Dask"},"next":{"title":"Dask DataFrame","url":"/notebooks/dask-dataframe","group":"Introductions to Dask"}}},"domain":"http://localhost:3000"}